<!-- 本の一覧ページ -->




<div class = "container">
    <div class = "row">
        <div class= "col-sm-3">
            <!-- 部分テンプレート呼び出し (引数を与える)-->
            <%= render 'users/list', user: current_user, book: @book %>
        </div>
        <div class= "col-sm-7">
            <h1>Books</h1>
            <table class="table table-striped">
                <thead>
                    <tr align=center>
                    <th></th>
                    <th>Title</th>
                    <th>Opinion</th>
                    </tr>
                </thead>
                <tbody>
                    <% @books.each do |book| %>
                        <tr>
                            <!-- 1:Nの関係から book.userのuser_idを引っ張ってくる -->
                            <!-- 画像に投稿ユーザーのマイページのリンクを挿入 -->
                            <td><%= attachment_image_tag book.user, :profile_image, :fill, 40, 40, format: 'jpeg', class: "profile-img", fallback: "no_image.jpg", size:'40x40' %></td>
                            <!-- 画像にマイページへのリンクができない -->
                            <!-- link_to  () , user_path(@user) -->
                            <td><%= link_to book.title, "/books/#{book.id}" %></td>
                            <td><%= book.body %></td>
                            <!-- いいね機能の実施 -->
                            <td>
                                <!-- 引数で渡されたユーザーのIDがfavoritesテーブルに存在していればtrue -->
                                <% if book.favorited_by?(current_user)%>
                                    <%= link_to book_favorites_path(book), method: :delete do %>
                                        <i class="glyphicon glyphicon-heart" aria-hidden="true" style="color: red;"></i>
                                        <%= book.favorites.count %><br> いいね
                                    <% end %>
                                <% else %>
                                    <%= link_to book_favorites_path(book), method: :post do %>
                                        <i class="glyphicon glyphicon-heart-o" aria-hidden="true"></i>
                                        <%= book.favorites.count %><br> いいね
                                    <% end %>
                                <% end %>
                            </td>
                        </tr>
                     <% end %>
                </tbody>
            </table>
        </div>
    </div>
</div>
